---
interface Props {
  keyPath: string;
  tag?: string;
  class?: string;
}

const { keyPath, tag = 'span', class: className = '' } = Astro.props;
---

<div data-i18n={keyPath} class={className}>
  <slot />
</div>

<script>
  import { ui } from '../i18n';

  function updateTranslations() {
    const lang = (localStorage.getItem('language') || 'es') as 'en' | 'es';
    const elements = document.querySelectorAll('[data-i18n]');

    elements.forEach((el) => {
      const key = el.getAttribute('data-i18n');
      if (!key) return;

      const keys = key.split('.');
      let value: any = ui[lang];

      for (const k of keys) {
        value = value?.[k];
      }

      if (value) {
        el.textContent = value;
      }
    });
  }

  document.addEventListener('DOMContentLoaded', updateTranslations);
</script>
